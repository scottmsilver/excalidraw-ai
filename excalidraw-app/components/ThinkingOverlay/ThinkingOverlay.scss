/**
 * ThinkingOverlay.scss
 * Apple Intelligence-style animated gradient border with shimmer particles
 * Warm reds/oranges with rotating glow
 */

// Main container - covers entire excalidraw canvas
.thinking-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  pointer-events: none;
  z-index: 999;
  overflow: hidden;
}

// Semi-transparent interim proposal image
.thinking-overlay__image {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
  opacity: 0.7;
  z-index: 100; // Above border and flash
  pointer-events: none;
  // Fade in animation
  animation: thinking-image-fade-in 0.3s ease-out forwards;

  // When positioned with canvas coordinates, override centering
  &--positioned {
    // Use position: fixed for viewport-relative positioning
    position: fixed;
    top: 0;
    left: 0;
    // Critical: override the animation's transform
    transform: none !important;
    max-width: none;
    max-height: none;
    object-fit: fill;
    // Use a different animation that doesn't transform
    animation: thinking-image-positioned-fade-in 0.3s ease-out forwards;
  }
}

// Animated gradient border
.thinking-overlay__border {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  pointer-events: none;
  border-radius: 0;
  background: transparent;
  overflow: hidden;

  // The rotating warm glow - oversized spinning gradient
  &::before {
    content: "";
    position: absolute;
    top: 50%;
    left: 50%;
    width: 200%;
    height: 200%;
    transform-origin: center center;
    background: conic-gradient(
      from 0deg,
      transparent 0deg,
      transparent 30deg,
      #ff4500 70deg,
      #ff6b35 110deg,
      #ffa500 150deg,
      #ffb347 190deg,
      #ff8c00 230deg,
      #ff5722 270deg,
      #ff4500 310deg,
      transparent 330deg,
      transparent 360deg
    );
    animation: thinking-spin-glow 2s linear infinite;
    filter: blur(6px);
    opacity: 0;
  }

  // Secondary glow trail
  &::after {
    content: "";
    position: absolute;
    top: 50%;
    left: 50%;
    width: 200%;
    height: 200%;
    transform-origin: center center;
    background: conic-gradient(
      from 180deg,
      transparent 0deg,
      transparent 40deg,
      rgba(255, 69, 0, 0.6) 80deg,
      rgba(255, 140, 0, 0.6) 140deg,
      rgba(255, 165, 0, 0.6) 200deg,
      rgba(255, 87, 34, 0.6) 260deg,
      transparent 320deg,
      transparent 360deg
    );
    animation: thinking-spin-glow 2s linear infinite;
    filter: blur(14px);
    opacity: 0;
  }
}

// Active thinking state
.thinking-overlay__border--thinking {
  &::before,
  &::after {
    opacity: 1;
    margin-top: -100%;
    margin-left: -100%;
  }

  // Use mask to show only the border ring
  -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
  -webkit-mask-composite: xor;
  mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
  mask-composite: exclude;
  padding: 8px;

  // Rough inner glow with multiple inset shadows
  box-shadow: inset 0 0 30px rgba(255, 100, 50, 0.3),
    inset 0 0 60px rgba(255, 140, 0, 0.15),
    inset 5px 0 20px rgba(255, 69, 0, 0.2),
    inset -5px 0 20px rgba(255, 165, 0, 0.2),
    inset 0 5px 20px rgba(255, 87, 34, 0.2),
    inset 0 -5px 20px rgba(255, 120, 0, 0.2),
    inset 10px 10px 40px rgba(255, 80, 0, 0.1),
    inset -10px -10px 40px rgba(255, 150, 50, 0.1);
  animation: thinking-inner-glow-pulse 1.5s ease-in-out infinite alternate;
}

// Accepted state - green flash then fade out
.thinking-overlay__border--accepted {
  box-shadow: inset 0 0 0 4px #22c55e, inset 0 0 20px rgba(34, 197, 94, 0.6);
  animation: thinking-accepted-pulse 0.6s ease-out forwards;
  padding: 0;
  -webkit-mask: none;
  mask: none;

  &::before,
  &::after {
    display: none;
  }
}

// Rejected state - red flash then fade out
.thinking-overlay__border--rejected {
  box-shadow: inset 0 0 0 4px #ef4444, inset 0 0 20px rgba(239, 68, 68, 0.6);
  animation: thinking-rejected-pulse 0.6s ease-out forwards;
  padding: 0;
  -webkit-mask: none;
  mask: none;

  &::before,
  &::after {
    display: none;
  }
}

// Initial flash overlay
.thinking-overlay__flash {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: radial-gradient(
    ellipse at center,
    rgba(255, 140, 50, 0.8) 0%,
    rgba(255, 100, 30, 0.6) 30%,
    rgba(255, 69, 0, 0.3) 60%,
    transparent 100%
  );
  opacity: 0;
  pointer-events: none;
  z-index: 99;
}

.thinking-overlay--flash .thinking-overlay__flash {
  animation: thinking-flash-wash 0.6s ease-out forwards;
}

// Shimmer particles container
.thinking-overlay__particles {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  pointer-events: none;
  z-index: 103;
  overflow: hidden;
}

// Individual shimmer particle - warm sparkle/glitter effect
.thinking-overlay__particle {
  position: absolute;
  background: radial-gradient(
    circle,
    rgba(255, 255, 255, 1) 0%,
    rgba(255, 120, 50, 0.9) 40%,
    rgba(255, 69, 0, 0) 70%
  );
  border-radius: 50%;
  opacity: 0;
  animation: thinking-shimmer-float 3s ease-in-out infinite;
  box-shadow: 0 0 8px rgba(255, 100, 50, 1), 0 0 16px rgba(255, 69, 0, 0.8),
    0 0 24px rgba(255, 87, 34, 0.5);
}

// Keyframes
@keyframes thinking-spin-glow {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@keyframes thinking-inner-glow-pulse {
  0% {
    box-shadow: inset 0 0 30px rgba(255, 100, 50, 0.25),
      inset 0 0 60px rgba(255, 140, 0, 0.1),
      inset 8px 0 25px rgba(255, 69, 0, 0.15),
      inset -8px 0 25px rgba(255, 165, 0, 0.15),
      inset 0 8px 25px rgba(255, 87, 34, 0.15),
      inset 0 -8px 25px rgba(255, 120, 0, 0.15);
  }
  100% {
    box-shadow: inset 0 0 40px rgba(255, 100, 50, 0.4),
      inset 0 0 80px rgba(255, 140, 0, 0.2),
      inset 3px 0 15px rgba(255, 69, 0, 0.25),
      inset -3px 0 15px rgba(255, 165, 0, 0.25),
      inset 0 3px 15px rgba(255, 87, 34, 0.25),
      inset 0 -3px 15px rgba(255, 120, 0, 0.25);
  }
}

@keyframes thinking-flash-wash {
  0% {
    opacity: 0;
    transform: scale(0.8);
  }
  20% {
    opacity: 1;
    transform: scale(1.05);
  }
  100% {
    opacity: 0;
    transform: scale(1);
  }
}

@keyframes thinking-accepted-pulse {
  0% {
    opacity: 1;
    filter: brightness(1);
  }
  50% {
    opacity: 1;
    filter: brightness(1.3);
  }
  100% {
    opacity: 0;
    filter: brightness(1);
  }
}

@keyframes thinking-rejected-pulse {
  0% {
    opacity: 1;
    filter: brightness(1);
  }
  50% {
    opacity: 1;
    filter: brightness(1.3);
  }
  100% {
    opacity: 0;
    filter: brightness(1);
  }
}

@keyframes thinking-shimmer-float {
  0% {
    opacity: 0.2;
    transform: translate(0, 0) scale(0.6);
  }
  15% {
    opacity: 1;
    transform: translate(5px, -10px) scale(1.3);
  }
  40% {
    opacity: 1;
    transform: translate(-8px, -25px) scale(1.1);
  }
  60% {
    opacity: 0.9;
    transform: translate(12px, -40px) scale(1.2);
  }
  80% {
    opacity: 0.6;
    transform: translate(-5px, -55px) scale(1);
  }
  100% {
    opacity: 0.1;
    transform: translate(0, -70px) scale(0.7);
  }
}

@keyframes thinking-image-fade-in {
  0% {
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.95);
  }
  100% {
    opacity: 0.7;
    transform: translate(-50%, -50%) scale(1);
  }
}

// Animation for positioned images (no transform)
@keyframes thinking-image-positioned-fade-in {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 0.7;
  }
}
